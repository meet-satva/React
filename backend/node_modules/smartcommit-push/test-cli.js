#!/usr/bin/env node

require("dotenv").config();
const {
  prepareCommitMessage,
  commitWithMessage,
  autoPush
} = require("./git-wrapper");

(async () => {
  try {
    const cmd = process.argv[2];

    if (!cmd) {
      console.log("Usage:");
      console.log("  commit        Create AI commit");
      console.log("  push [branch] Push to branch");
      process.exit(0);
    }


    if (cmd === "commit") {
      console.log("üîç Staging files and generating AI commit message...\n");

      const msg = await prepareCommitMessage(); 

      if (!msg) {
        console.log("‚ö†Ô∏è No changes to commit");
        process.exit(0);
      }

      console.log("üìù AI Suggestion:\n" + msg + "\n");

      commitWithMessage(msg);
      console.log("‚úÖ Committed successfully");
      process.exit(0);
    }

  
    if (cmd === "push") {
      const branch = process.argv[3];

      console.log("üöÄ Pushing to remote...");
      autoPush(branch);
      console.log("‚úÖ Pushed successfully");
      process.exit(0);
    }

 
    console.log(`Unknown command: ${cmd}`);
    console.log("Available commands: commit, push");

  } catch (err) {
    console.error("‚ùå Error:", err.response?.data || err.message || err);
    process.exit(1);
  }
})();
