#!/usr/bin/env node

require("dotenv").config();
const readline = require("readline");
const {
  prepareCommitMessage,
  commitWithMessage
} = require("../git-wrapper");

(async () => {
  try {
    console.log("ğŸ” AI analyzing your staged changes...\n");

    const aiMessage = await prepareCommitMessage();

    if (!aiMessage) {
      console.log("âš ï¸ No changes to commit.");
      process.exit(0);
    }

    console.log("ğŸ“ Suggested Commit Message:\n");
    console.log(aiMessage);
    console.log("\nPress ENTER to accept or type a new message:\n");

    const rl = readline.createInterface({
      input: process.stdin,
      output: process.stdout
    });

    rl.question("> ", (input) => {
      const finalMessage = input.trim() || aiMessage;

      try {
        commitWithMessage(finalMessage);
      } catch (err) {
        console.error("âŒ Commit failed:", err.message);
      }
      rl.close();
    });
  } catch (err) {
    console.error("âŒ Error:", err.message);
  }
})();
